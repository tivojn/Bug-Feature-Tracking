<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation — Bug & Feature Tracker</title>
    <style>
        :root {
            --bg: #191919;
            --surface: #232323;
            --surface2: #2a2a2a;
            --border: #333;
            --text: #e0e0e0;
            --text-dim: #888;
            --accent: #4f9a5e;
            --accent-dim: #3a7a48;
            --red: #e06c75;
            --orange: #d19a66;
            --blue: #61afef;
            --purple: #c678dd;
            --cyan: #56b6c2;
            --green: #98c379;
            --yellow: #e5c07b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 0;
        }
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .header-inner {
            max-width: 860px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header h1 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header h1 span { color: var(--accent); }
        .back-link {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 13px;
            transition: color 0.2s;
        }
        .back-link:hover { color: var(--text); }
        .container {
            max-width: 860px;
            margin: 0 auto;
            padding: 32px 24px 80px;
        }
        h2 {
            font-size: 22px;
            font-weight: 600;
            margin: 40px 0 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }
        h2:first-child { margin-top: 0; }
        h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 24px 0 8px;
            color: var(--text);
        }
        p { margin: 8px 0; color: var(--text-dim); font-size: 14px; }
        .endpoint-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 16px;
            margin: 16px 0;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 14px;
        }
        .method {
            background: var(--accent);
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 12px;
        }
        code {
            background: var(--surface2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 13px;
            color: var(--cyan);
        }
        pre {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
            margin: 12px 0;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        pre .key { color: var(--blue); }
        pre .str { color: var(--green); }
        pre .num { color: var(--orange); }
        pre .comment { color: var(--text-dim); font-style: italic; }
        pre .cmd { color: var(--yellow); }
        pre .flag { color: var(--purple); }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 14px;
        }
        th, td {
            text-align: left;
            padding: 10px 14px;
            border-bottom: 1px solid var(--border);
        }
        th {
            background: var(--surface);
            color: var(--text-dim);
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        td { color: var(--text); }
        td code { font-size: 12px; }
        .required {
            color: var(--red);
            font-size: 11px;
            font-weight: 600;
        }
        .optional {
            color: var(--text-dim);
            font-size: 11px;
        }
        .status-code {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 12px;
            font-family: 'SF Mono', Monaco, monospace;
        }
        .s200 { background: #1a3a1a; color: var(--green); }
        .s400 { background: #3a2a1a; color: var(--orange); }
        .s401 { background: #3a1a1a; color: var(--red); }
        .s405 { background: #2a1a3a; color: var(--purple); }
        .s500 { background: #1a2a3a; color: var(--blue); }
        .setup-box {
            background: var(--surface);
            border: 1px solid var(--accent-dim);
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
        }
        .setup-box h4 {
            color: var(--accent);
            font-size: 14px;
            margin-bottom: 8px;
        }
        .setup-box p { margin: 4px 0; }
        .setup-box ol {
            margin: 8px 0 0 20px;
            color: var(--text-dim);
            font-size: 14px;
        }
        .setup-box ol li { margin: 6px 0; }
        .try-it {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .try-it h3 { margin-top: 0; }
        .try-it textarea, .try-it input[type="text"] {
            width: 100%;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 13px;
            padding: 10px 12px;
            margin: 6px 0;
            resize: vertical;
        }
        .try-it textarea:focus, .try-it input:focus {
            outline: none;
            border-color: var(--accent);
        }
        .try-it label {
            display: block;
            font-size: 12px;
            color: var(--text-dim);
            margin-top: 10px;
            font-weight: 600;
        }
        .try-it select {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 13px;
            padding: 8px 10px;
            margin: 6px 0;
        }
        .try-it .btn-row {
            display: flex;
            gap: 10px;
            margin-top: 14px;
            align-items: center;
        }
        .try-btn {
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 8px 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .try-btn:hover { background: var(--accent-dim); }
        .try-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .try-result {
            margin-top: 12px;
            display: none;
        }
        .try-result.show { display: block; }
        .try-result pre {
            max-height: 400px;
            overflow-y: auto;
        }
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-dim);
            font-size: 11px;
            padding: 3px 8px;
            cursor: pointer;
        }
        .copy-btn:hover { color: var(--text); border-color: var(--accent); }
        .pre-wrap { position: relative; }
        .note {
            background: #1a2a1a;
            border-left: 3px solid var(--accent);
            padding: 12px 16px;
            border-radius: 0 6px 6px 0;
            margin: 12px 0;
            font-size: 13px;
            color: var(--text-dim);
        }
    </style>
</head>
<body>

<div class="header">
    <div class="header-inner">
        <h1><span>API</span> Documentation</h1>
        <a href="/" class="back-link">&larr; Back to Tracker</a>
    </div>
</div>

<div class="container">

    <h2>Import Endpoint</h2>
    <p>Parse free-form text into structured bug/feature items using AI, and optionally import them into the database. This is the same AI parsing used in the web UI's "AI Import" feature.</p>

    <div class="endpoint-badge">
        <span class="method">POST</span>
        <span>/api/import</span>
    </div>

    <!-- Authentication -->
    <h3>Authentication</h3>
    <p>All requests require a Bearer token:</p>
    <pre>Authorization: Bearer YOUR_API_SECRET</pre>

    <div class="note">
        The API secret is set as the <code>API_SECRET</code> environment variable in Vercel. This is the <strong>only</strong> env var you need to add — the Anthropic API key and Supabase credentials are already configured.
    </div>

    <!-- Setup -->
    <div class="setup-box">
        <h4>One-Time Setup</h4>
        <ol>
            <li>Go to <strong>Vercel Dashboard &rarr; Settings &rarr; Environment Variables</strong></li>
            <li>Add <code>API_SECRET</code> — choose any strong secret string (e.g. generate with <code>openssl rand -hex 32</code>)</li>
            <li>Redeploy (or it takes effect on next deploy)</li>
            <li>Use that same secret as your Bearer token in scripts</li>
        </ol>
        <p style="margin-top:10px">That's it. No other env vars needed — <code>ANTHROPIC_API_KEY</code> and Supabase are already configured.</p>
    </div>

    <!-- Request -->
    <h3>Request Body</h3>
    <pre>{
  <span class="key">"text"</span>: <span class="str">"login page crashes on Safari, need dark mode toggle, search is slow"</span>,
  <span class="key">"mode"</span>: <span class="str">"import"</span>
}</pre>

    <table>
        <thead><tr><th>Field</th><th>Type</th><th></th><th>Description</th></tr></thead>
        <tbody>
            <tr>
                <td><code>text</code></td>
                <td>string</td>
                <td><span class="required">required</span></td>
                <td>Free-form text describing bugs and/or features</td>
            </tr>
            <tr>
                <td><code>mode</code></td>
                <td>string</td>
                <td><span class="optional">optional</span></td>
                <td><code>"import"</code> (default) — parse and save. <code>"preview"</code> — parse only, don't save.</td>
            </tr>
        </tbody>
    </table>

    <!-- Response -->
    <h3>Success Response</h3>
    <pre>{
  <span class="key">"success"</span>: <span class="num">true</span>,
  <span class="key">"mode"</span>: <span class="str">"import"</span>,
  <span class="key">"items"</span>: [
    {
      <span class="key">"id"</span>: <span class="str">"uuid-here"</span>,
      <span class="key">"type"</span>: <span class="str">"bug"</span>,
      <span class="key">"category"</span>: <span class="str">"ui"</span>,
      <span class="key">"title"</span>: <span class="str">"Login page crashes on Safari"</span>,
      <span class="key">"description"</span>: <span class="str">"The login page is crashing when accessed via Safari browser."</span>,
      <span class="key">"priority"</span>: <span class="str">"high"</span>,
      <span class="key">"status"</span>: <span class="str">"open"</span>,
      <span class="key">"created_at"</span>: <span class="str">"2026-02-20T..."</span>
    }
  ],
  <span class="key">"count"</span>: <span class="num">3</span>
}</pre>
    <p>In <code>preview</code> mode, items won't have <code>id</code> or <code>created_at</code> since they aren't saved.</p>

    <!-- Errors -->
    <h3>Error Responses</h3>
    <table>
        <thead><tr><th>Status</th><th>Meaning</th></tr></thead>
        <tbody>
            <tr><td><span class="status-code s400">400</span></td><td>Missing or empty <code>text</code> field, or invalid <code>mode</code></td></tr>
            <tr><td><span class="status-code s401">401</span></td><td>Missing or invalid API secret</td></tr>
            <tr><td><span class="status-code s405">405</span></td><td>Wrong HTTP method (use POST)</td></tr>
            <tr><td><span class="status-code s500">500</span></td><td>Server config error, AI parsing failure, or database error</td></tr>
        </tbody>
    </table>

    <!-- curl examples -->
    <h2>Examples</h2>

    <h3>Preview (parse only)</h3>
    <div class="pre-wrap">
        <pre><span class="cmd">curl</span> <span class="flag">-X POST</span> https://bug-feature-tracking.vercel.app/api/import \
  <span class="flag">-H</span> <span class="str">"Authorization: Bearer YOUR_API_SECRET"</span> \
  <span class="flag">-H</span> <span class="str">"Content-Type: application/json"</span> \
  <span class="flag">-d</span> <span class="str">'{"text": "login crashes on mobile, search is slow", "mode": "preview"}'</span></pre>
    </div>

    <h3>Import (parse + save)</h3>
    <div class="pre-wrap">
        <pre><span class="cmd">curl</span> <span class="flag">-X POST</span> https://bug-feature-tracking.vercel.app/api/import \
  <span class="flag">-H</span> <span class="str">"Authorization: Bearer YOUR_API_SECRET"</span> \
  <span class="flag">-H</span> <span class="str">"Content-Type: application/json"</span> \
  <span class="flag">-d</span> <span class="str">'{"text": "login crashes on mobile, need dark mode toggle"}'</span></pre>
    </div>

    <h3>Python</h3>
    <div class="pre-wrap">
        <pre><span class="cmd">import</span> requests

response = requests.post(
    <span class="str">"https://bug-feature-tracking.vercel.app/api/import"</span>,
    headers={<span class="str">"Authorization"</span>: <span class="str">"Bearer YOUR_API_SECRET"</span>},
    json={<span class="str">"text"</span>: <span class="str">"login crashes on mobile, need dark mode"</span>}
)
print(response.json())</pre>
    </div>

    <h3>JavaScript / Node.js</h3>
    <div class="pre-wrap">
        <pre><span class="cmd">const</span> res = <span class="cmd">await</span> fetch(<span class="str">"https://bug-feature-tracking.vercel.app/api/import"</span>, {
  method: <span class="str">"POST"</span>,
  headers: {
    <span class="str">"Content-Type"</span>: <span class="str">"application/json"</span>,
    <span class="str">"Authorization"</span>: <span class="str">"Bearer YOUR_API_SECRET"</span>,
  },
  body: JSON.stringify({ text: <span class="str">"login crashes on mobile"</span> }),
});
<span class="cmd">const</span> data = <span class="cmd">await</span> res.json();
console.log(data);</pre>
    </div>

    <!-- Try It -->
    <h2>Try It</h2>
    <div class="try-it">
        <h3>Live API Tester</h3>
        <label>API Secret</label>
        <input type="text" id="try-secret" placeholder="Paste your API_SECRET here">

        <label>Text to parse</label>
        <textarea id="try-text" rows="3" placeholder="e.g. login page crashes on Safari, need dark mode toggle, search is very slow">login page crashes on Safari, need dark mode toggle, search is very slow</textarea>

        <label>Mode</label>
        <select id="try-mode">
            <option value="preview">preview (parse only)</option>
            <option value="import">import (parse + save)</option>
        </select>

        <div class="btn-row">
            <button class="try-btn" id="try-send" onclick="sendTestRequest()">Send Request</button>
            <span id="try-status" style="font-size:12px;color:var(--text-dim)"></span>
        </div>

        <div class="try-result" id="try-result">
            <pre id="try-output"></pre>
        </div>
    </div>

    <!-- API Key FAQ -->
    <h2>API Key FAQ</h2>

    <h3>Where do I get my API key?</h3>
    <p>The API key (<code>API_SECRET</code>) is a secret string <strong>you create yourself</strong>. It's not generated by any service — you pick it, set it in Vercel, and use it in your scripts.</p>
    <div class="setup-box">
        <h4>Generate a secure key</h4>
        <pre><span class="comment"># Option 1: openssl</span>
<span class="cmd">openssl</span> rand -hex 32

<span class="comment"># Option 2: python</span>
<span class="cmd">python3</span> -c "import secrets; print(secrets.token_hex(32))"</pre>
        <p style="margin-top:8px">Copy the output and add it as <code>API_SECRET</code> in Vercel Dashboard &rarr; Settings &rarr; Environment Variables. Use the same value in your scripts.</p>
    </div>

    <h3>Is there a key management UI or module?</h3>
    <p>Not currently. The setup is intentionally simple: one shared secret set as an env var. If you need multiple API keys, rotation, or per-user keys, that would be a future enhancement — likely a <code>api_keys</code> table in Supabase with a management UI in the settings panel.</p>

    <h3>What about the Anthropic key and Supabase credentials?</h3>
    <p>You don't need to set these up separately for the API. The endpoint uses the same Anthropic API key already in your Vercel env vars (<code>ANTHROPIC_API_KEY</code>) and the same Supabase credentials the webapp uses. No additional configuration needed.</p>

</div>

<script>
async function sendTestRequest() {
    const secret = document.getElementById('try-secret').value.trim();
    const text = document.getElementById('try-text').value.trim();
    const mode = document.getElementById('try-mode').value;
    const btn = document.getElementById('try-send');
    const status = document.getElementById('try-status');
    const resultDiv = document.getElementById('try-result');
    const output = document.getElementById('try-output');

    if (!secret) { status.textContent = 'Enter your API secret'; status.style.color = '#e06c75'; return; }
    if (!text) { status.textContent = 'Enter some text to parse'; status.style.color = '#e06c75'; return; }

    btn.disabled = true;
    status.textContent = 'Sending...';
    status.style.color = '#888';
    resultDiv.classList.remove('show');

    try {
        const res = await fetch('/api/import', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + secret,
            },
            body: JSON.stringify({ text, mode }),
        });

        const data = await res.json();
        output.textContent = JSON.stringify(data, null, 2);
        resultDiv.classList.add('show');
        status.textContent = res.ok ? 'Success (' + res.status + ')' : 'Error (' + res.status + ')';
        status.style.color = res.ok ? '#98c379' : '#e06c75';
    } catch (e) {
        output.textContent = 'Network error: ' + e.message;
        resultDiv.classList.add('show');
        status.textContent = 'Failed';
        status.style.color = '#e06c75';
    } finally {
        btn.disabled = false;
    }
}
</script>

</body>
</html>
